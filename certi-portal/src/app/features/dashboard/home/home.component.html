<div class="dashboard-content">
  <!-- Welcome Card -->
  <div class="welcome-card">
    <div class="welcome-header">
      <div class="welcome-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
      </div>
      <div class="welcome-text">
        <h2>¡Hola, {{ currentUser()?.name }}!</h2>
        <p>Bienvenido al Sistema de Gestión de Certificados.</p>
      </div>
    </div>

    <!-- Personal Summary (Visible for everyone) -->
    <div class="personal-stats" *ngIf="stats()?.my_certificates_count !== undefined">
      <div class="p-stat-item">
        <span class="p-stat-value">{{ stats()?.my_certificates_count }}</span>
        <span class="p-stat-label">Mis Certificados</span>
      </div>
    </div>
  </div>

  <!-- System Stats Grid (Only if permissions allow) -->
  <div class="stats-section" *ngIf="hasSystemStats()">
    <h3>Resumen del Sistema</h3>
    <div class="stats-grid">
      <!-- Users -->
      <div class="stat-card" *ngIf="stats()?.total_users !== undefined">
        <div class="stat-icon blue">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ stats()?.total_users }}</div>
          <div class="stat-label">Usuarios</div>
          <div class="stat-sub" *ngIf="stats()?.new_users_last_month">
            +{{ stats()?.new_users_last_month }} este mes
          </div>
        </div>
      </div>

      <!-- Certificates -->
      <div class="stat-card" *ngIf="stats()?.total_certificates !== undefined">
        <div class="stat-icon green">
          <i class="fas fa-certificate"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ stats()?.total_certificates }}</div>
          <div class="stat-label">Certificados Emitidos</div>
          <div class="stat-sub" *ngIf="stats()?.certificates_issued_last_month">
            +{{ stats()?.certificates_issued_last_month }} este mes
          </div>
        </div>
      </div>

      <!-- Activities -->
      <div class="stat-card" *ngIf="stats()?.total_activities !== undefined">
        <div class="stat-icon purple">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ stats()?.total_activities }}</div>
          <div class="stat-label">Actividades</div>
          <div class="stat-sub" *ngIf="stats()?.active_activities">
            {{ stats()?.active_activities }} activas
          </div>
        </div>
      </div>

      <!-- Companies -->
      <div class="stat-card" *ngIf="stats()?.total_companies !== undefined">
        <div class="stat-icon orange">
          <i class="fas fa-building"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ stats()?.total_companies }}</div>
          <div class="stat-label">Empresas</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Certificates (Personal) -->
  <div class="recent-certificates-section" *ngIf="stats()?.my_recent_certificates?.length">
    <h3>Mis Certificados Recientes</h3>
    <div class="certificates-list">
      <div *ngFor="let cert of stats()?.my_recent_certificates" class="certificate-item">
        <div class="certificate-icon">
          <i class="fas fa-certificate"></i>
        </div>
        <div class="certificate-info">
          <h4>{{ cert.activity_name }}</h4>
          <p class="issue-date">Emitido el {{ formatDate(cert.issue_date) }}</p>
          <small class="cert-code">Código: {{ cert.code }}</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State if no data -->
  <div class="empty-dashboard" *ngIf="!isLoading() && !hasSystemStats() && (!stats()?.my_recent_certificates?.length)">
    <div class="empty-content">
      <i class="fas fa-inbox"></i>
      <p>No tienes actividad reciente para mostrar.</p>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading()" class="loading-overlay">
    <div class="spinner"></div>
  </div>
</div>